<link rel="import" href="../component-extensions/component-extensions.html">
<link rel="import" href="../elliptical-container/elliptical-container.html">
<script src="dist/elliptical.init.js"></script>
<script>
    //Base Component Behavior
    Elliptical.ComponentBehavior={};
    Elliptical.ComponentBehavior.properties={

        service:{
            type:String,
            value:null
        }

    };

    Object.assign(Elliptical.ComponentBehavior,elliptical.extensions.base);
    Elliptical.ComponentBehavior._createDataStore=function(){
        this._data={
            _store:new Map(),
            get:function(key){
                return this._store.get(key);
            },
            set:function(key,val){
                this._store.set(key,val);
            },
            click:'touchclick',
            hover:'touchhover'
        };
    };

    //use click-event instead of on-click to avoid conflicts
    Elliptical.ComponentBehavior._delegateEventListener=function(){
        this.element.on(this._data.click,'[click-event]',this._listenerCallback.bind(this));
    };

    Elliptical.ComponentBehavior._listenerCallback=function(event){
        var target=$(event.currentTarget);
        var fn=target.attr('click-event');
        if(fn){
            if(this[fn]){
                this[fn](event);
            }
        }
    };

    Elliptical.ComponentBehavior.__press=function(){
        return ('ontouchend' in document) ? 'touchend' : 'click';
    };

    Elliptical.ComponentBehavior.__tap=function(){
        return ('ontouchend' in document) ? 'tap' : 'click';
    };

    Elliptical.ComponentBehavior.__bindPressEvent=function(){
        var self=this;
        var data=this._data;
        Object.defineProperty(data, 'press', {
            get: function() { return self.__press(); },
            enumerable: true,
            configurable: true
        });
    };

    Elliptical.ComponentBehavior.__bindTapEvent=function(){
        var self=this;
        var data=this._data;
        Object.defineProperty(data, 'tap', {
            get: function() { return self.__tap(); },
            enumerable: true,
            configurable: true
        });
    };

    Elliptical.ComponentBehavior.__setElementProperties=function(){
        var service=this.getAttribute('service');
        if(service){
            this.service=service;
        }
    };

    Elliptical.ComponentBehavior._disposeEventListener=function(){
        this.element.off(this._data.click,'[click-event]');
    };


    Elliptical.ComponentBehavior.$service=function(name){
        if(name===undefined){
            name=this.service;
        }
        return elliptical.Container.getType(name);
    };

    Elliptical.ComponentBehavior.$serviceAsync=function(name,callback){
        if(name===undefined){
            callback=name;
            name=this.service;
        }
        elliptical.Container.getTypeAsync(name,callback);
    };


    Elliptical.ComponentBehavior._bindPublicElementMethods=function(){
        var self=this;
        var node=this;
        node.hide=function(){
            self._hide();
        };

        node.show=function(){
            self._show();
        };

    };


    Elliptical.ComponentBehavior.created=function(){
        this.element=$(this);
        this._createDataStore();
        this._delegateEventListener();
        this.__bindPressEvent();
        this.__bindTapEvent();
        this._setOptionsFromAttribute();
        this.__setElementProperties();
        this._setChildrenAttributes();
        this._bindPublicElementMethods();
    };

    Elliptical.ComponentBehavior.detached=function(){
        this._disposeEventListener();
    };

    //Navigation Behavior
    Elliptical.NavigationBehavior={};
    Object.assign(Elliptical.NavigationBehavior,elliptical.extensions.drawer,elliptical.extensions.navigation);

</script>